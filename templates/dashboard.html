<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<form>
    <div>
        <h1 style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Dashboard</font>
        </h1>
        <hr>
        <table align="center" border="1" cellpadding="1" cellspacing="1" style="width: 800px">
            <tbody>
            <tr>
                <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Answers
                    Distribution</font></td>
                <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Average
                    level of
                    satisfaction</font></td>
                <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Number of
                    responses</font></td>
            </tr>
            <tr>
                <td style="text-align: center;">
                    <p><font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><img alt="" height="200" src="123"
                                                                                        width="400"></font></p>
                </td>
                <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><font
                        size="6">0</font></font></td>
                <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><font
                        size="6">0</font></font></td>
            </tr>
            </tbody>
        </table>

        <p>Average Scores</p>
        <ul>
            % for score in scores:
            <li>{{score[0]}} -> {{score[1]}}</li>
            % end
        </ul>

        <p align="center"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><input name="update_button"
                                                                                             type="button"
                                                                                             value="Update"></font></p>
        <hr>
        <table align="center" border="0" cellpadding="1" cellspacing="1" style="width: 800px">
            <tbody>
            <tr>
                <td>
                    <p align="center"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Choose the
                        user:</font>
                    </p>

                    <p align="center"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><select
                            name="list_of_users" size="5">
                        <option value="1">some user</option>
                    </select></font></p>
                </td>
                <td>
                    <table align="center" border="1" cellpadding="1" cellspacing="1" style="width: 500px;">
                        <tbody>
                        <tr>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Question</font>
                            </td>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Answer</font>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><font
                                    face="Lucida Sans Unicode, Lucida Grande, sans-serif">1)</font></td>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">some&nbsp;answer</font>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">Please
                                choose your level of satisfaction with the cources in IU?</font></td>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">some
                                answer</font></td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">How
                                did you deal with army? Please, describe.</font></td>
                            <td style="text-align: center;"><font face="Lucida Sans Unicode, Lucida Grande, sans-serif">some
                                answer</font><br>
                                &nbsp;</td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>
        <p align="center"><br>

            <font face="Lucida Sans Unicode, Lucida Grande, sans-serif"><input name="logout_button" type="submit"
                                                                               value="Logout" formmethod="post"></font>
        </p>


    </div>
</form>


<div id="chart_div">
</div>
<div>
    <button id="logoutButton">Logout</button>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {
        packages: ['corechart', 'bar']
    });
    google.charts.setOnLoadCallback(getData);
    //Функция принимает JSON параметры по примеру ниже
    //При необходимости можно их раскомментировать и посмотреть, что получается

    var q;
    var a;

    function getData()
    {
        $.ajax({
            type: "GET",
            url: "/questions_in_english",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                q = data;
                $.ajax({
                    type: "GET",
                    url: "/answers",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        a = data;
                        drawMultSeries(q, a);
                    }
                });
            }
        });
    }

    getData();

    function drawMultSeries(q, a) {

        var names_of_questions = [];

        for (var i = 0; i < q.pages[0].questions.length; i++) {
            if (q.pages[0].questions[i].type == "radiogroup") {
                names_of_questions.push(q.pages[0].questions[i].name);
            }
        }

        var questions_results = [];


        for (var i = 0; i < names_of_questions.length; i++) {
            questions_results.push([
                [names_of_questions[i], 'count']
            ]);
        }


        function inc_question_value(question_name, answer, question_results) {
            function find_answer_count_pair(data, answer) {
                for (var i = 0; i < data.length; i++) {
                    var flag = false;
                    if (data[i][0] == answer) {
                        data[i][1] = data[i][1] + 1;
                        flag = true;
                        break;
                    }
                }
                if (flag == false) {
                    data.push([answer, 1]);
                }
            }

            for (var i = 0; i < question_results.length; i++) {
                if (question_results[i][0][0] == question_name) {
                    find_answer_count_pair(question_results[i], answer);
                }
            }
        }

        for (var id in a) {
            for (var question in a[id]) {
                if (names_of_questions.indexOf(question) != -1) {
                    inc_question_value(question, a[id][question], questions_results);
                }
            }
        }
        //
        // В части с визуализацией нужно указать нужный div
        for (var i = 0; i < questions_results.length; i++) {
            var data = google.visualization.arrayToDataTable(questions_results[i]);

            var options = {
                title: 'Answer Distribution',
                chartArea: {
                    width: '50%'
                },
                hAxis: {
                    title: 'Count',
                    minValue: 0
                },
                vAxis: {
                    title: 'Number of question'
                }
            };

            var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    }

    $("#logoutButton").click(function () {
        $.ajax({
            type: "POST",
            url: "/logout",
            success:function(data) {
                location.reload();
            }
        });
    });
</script>

</body>
</html>